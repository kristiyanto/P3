---
title: | 
  | Portable Proteomics Pipeline (P3) 
  | Labelled (iTRAQ4) Benchmark
author: "Daniel Kristiyanto (daniel.kristiyanto@pnnl.gov)"
date: \today
fontsize: 11pt
output: pdf_document
bibliography: ../../media/ref.bib
nocite: |
  @domon2006mass, @deutsch2010mass, @MSnba83
csl: ../../media/biomed-central.csl
header-includes:
  \usepackage{fancyhdr}
  \usepackage{graphicx}
  \usepackage{hyperref}
  \pagestyle{fancy}
  \setlength\headheight{28pt}
  \rhead{\includegraphics[width = .2\textwidth]{../../media/pnnllogo.png}}
  \fancyfoot[LE,RO]{kristiyanto/p3:benchmark}
---
\rule{\textwidth}{1pt}

```{r, warning=FALSE, echo=FALSE, include=FALSE}
#setwd("~/Documents/GITHUB/P3/itraquant/Benchmark/itraq-benchmark/")
load("~/Documents/GITHUB/P3/itraquant/Benchmark/itraq-benchmark/itraq-benchmark.RData")
library(MSnbase)
library(mzID)
cols <- c("accession", "pepseq", "ms-gf:evalue")
```



The purpose of this document is to benchmark the iTRAQ quantification on the Portable Proteomics Pipelines (P3) containers.

# Input
1. `r mzid.files` : The identification file (product of MSGF+)
2. `r mzml.files` : The mass spectometry dataset
3. `r mzml.sp`    : The quantification results used to benchmark (calcullated by PNNL)

# Methods
## Identification
```{r}
## The identification file
mzids.raw
head(mzid.flat[order(mzid.flat[,"ms-gf:evalue"]),])[1:3,]
```


Based on this data, peptide `r pep` was listed as a good quality of identification with lowest e-value. 


## Spectrum Objects
```{r}
msexp.raw
```
The spectrum data consists of 1606 percursor ions and with features ranged from X1.1 to x9999.1.

This data then paired with the identification file using `addIdentificationData` tool from MSnBase, resulting the table below:
```{r}
### The spectra objects enrinched with identification file
msexp.id
idSummary(msexp.id)
#head(fData(msexp.id))[1:3,]
```

Table focusing on the peptide `r pep`:
```{r}
zoomData <- fData(msexp.id)[fData(msexp.id)$pepseq==pep & !is.na(fData(msexp.id)$pepseq),]
zoomData
```

From this table, we know that this peptide was identified from features `r rownames(zoomData)`.

Using the `quantify` function from MSnBase, with parameters `mehod=max, verbose=FALSE, strict=FALSE`, resulting:

```{r}
## Features 
zoomData[,cols]
exprs(qnt)[row.names(exprs(qnt))==row.names(zoomData),]
plot(msexp.id[["X15545.1"]],reporters=iTRAQ4, full=T)
```


## Quantification
This quantification then compared to the quantification data resulted from PNNL, by matching the scan number.
```{r}
zoomData$`scan number(s)`
msexp.sp[msexp.sp$ScanNumber==zoomData$`scan number(s)`,]
```


## Comparasion and error
The differences between the calculation by MSnBase and by PNNL:
```{r}
zoomData$`scan number(s)`
from.msnbase  <- exprs(qnt)[row.names(zoomData),]
from.pnnl     <- msexp.sp[msexp.sp$ScanNumber==zoomData$`scan number(s)`,c("Ion_114", "Ion_115","Ion_116", "Ion_117")]
show(from.msnbase)
show(from.pnnl)
calc.error    <- from.msnbase - from.pnnl
calc.error
```


Repeating the same process for all of peptides with e-value < 50

```{r}
# Original data
dim(qnt.id)         # From MSXML File e-value < 50
dim(msexp.sp)       # From PNNL (all)
qnt.merged <- merge(qnt.id, msexp.sp, by.x = "scan number(s)", by.y = "ScanNumber", all.x = T, all.y = F)
dim(qnt.merged)     # Merged Data (left Join)
head(qnt.merged[,c(cols.sp, cols.p3)])
```

The error/differences (results from MsnBase - results from PNNL):
```{r}
q.Error <- qnt.merged[,c("scan number(s)", "pepseq", "ms-gf:evalue")]
q.Error <- cbind(q.Error, "errIon114"= qnt.merged$iTRAQ4.114 - qnt.merged$Ion_114, "errIon115"=qnt.merged$iTRAQ4.115 - qnt.merged$Ion_115, "errIon116"=qnt.merged$iTRAQ4.116 - qnt.merged$Ion_116, "errIon117"=qnt.merged$iTRAQ4.117 - qnt.merged$Ion_117)

head(q.Error[order(q.Error$`ms-gf:evalue`),])
boxplot(q.Error[,c("errIon114","errIon115","errIon116","errIon117")])
summary(q.Error[,c("errIon114","errIon115","errIon116","errIon117")])
```
# References